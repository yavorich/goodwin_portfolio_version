server {
    listen 80;
    listen [::]:80;

    server_name my.gdw.finance;
    server_tokens off;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 302 https://my.gdw.finance$request_uri;
    }
}

server {
    listen 80;
    listen [::]:80;

    server_name admin.gdw.finance;
    server_tokens off;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 302 https://admin.gdw.finance$request_uri;
    }
}

server {
        listen 80;
        listen [::]:80;

        server_name gdw.finance;
        server_tokens off;

        # Эта секция обязательна, она говорит nginx слушать роут по которому certbot
        # проверит подлинность домена
        location /.well-known/acme-challenge/ {
                root /var/www/certbot;
        }

        # Эта секция необязательна, она нужна для редиректа трафика с http://
        # на https://
        location / {
                # 301 - permanent redirect, it will be cached in browser
                # so for testing, use 302 code so it won't be permanently cached in browser
                return 302 https://gdw.finance$request_uri;
        }
}

server {
        listen 443 default_server ssl http2;
        listen [::]:443 ssl http2;

        server_name gdw.finance;

        ssl_certificate /etc/nginx/ssl/live/gdw.finance/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/live/gdw.finance/privkey.pem;

        location / {
                proxy_pass http://66.29.133.125:8000;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

                # Установка заголовков для обработки статических файлов
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header X-Forwarded-Host $host;
                proxy_set_header X-Forwarded-Port $server_port;

                # Настройка кэширования и заголовков для статических файлов
                proxy_cache_bypass $http_upgrade;
                proxy_ignore_headers Cache-Control;
                proxy_cache_valid any 30d;
                proxy_cache_key $scheme$proxy_host$request_uri$is_args$args;
        }

        location /api/v1/ {
                proxy_pass http://66.29.133.125:8000;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "upgrade";
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Настройка обслуживания статических файлов
        location /static/ {
                alias /app/backend/static/;
                expires 30d;
                add_header Cache-Control "public";
        }

        # Настройка обслуживания медиа файлов
        location /media/ {
                alias /app/backend/media/;
                expires 30d;
                add_header Cache-Control "public";
        }

        # Настройка для административной панели Django
        location /admin/ {
                proxy_pass http://66.29.133.125:8000;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

                # Установка заголовков для обработки статических файлов
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header X-Forwarded-Host $host;
                proxy_set_header X-Forwarded-Port $server_port;

                # Настройка кэширования и заголовков для статических файлов
                proxy_cache_bypass $http_upgrade;
                proxy_ignore_headers Cache-Control;
                proxy_cache_valid any 30d;
                proxy_cache_key $scheme$proxy_host$request_uri$is_args$args;
        }
}

# server {
#         listen 80;
#         listen [::]:80;

#         server_name goodwinfinance.dfa-media.ru;
#         server_tokens off;

#         # Эта секция обязательна, она говорит nginx слушать роут по которому certbot
#         # проверит подлинность домена
#         location /.well-known/acme-challenge/ {
#                 root /var/www/certbot;
#         }

#         # Эта секция необязательна, она нужна для редиректа трафика с http://
#         # на https://
#         location / {
#                 # 301 - permanent redirect, it will be cached in browser
#                 # so for testing, use 302 code so it won't be permanently cached in browser
#                 return 302 https://goodwinfinance.dfa-media.ru$request_uri;
#         }
# }

# server {
#         listen 443 ssl http2;
#         listen [::]:443 ssl http2;

#         server_name goodwinfinance.dfa-media.ru;

#         ssl_certificate /etc/nginx/ssl/live/goodwinfinance.dfa-media.ru/fullchain.pem;
#         ssl_certificate_key /etc/nginx/ssl/live/goodwinfinance.dfa-media.ru/privkey.pem;

#         location / {
#                 # Здесь тебе скорее всего надо поменять только значение `proxy_pass`
#                 # чтобы nginx редиректил на твоё приложение

#                 proxy_pass http://5.35.90.18:3000;
#                 proxy_set_header Host $host;
#                 proxy_set_header X-Real-IP $remote_addr;
#                 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         }
# }
