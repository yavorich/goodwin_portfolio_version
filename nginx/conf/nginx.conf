server {
    listen  80;
    listen [::]:80;

    server_name     goodwinback.dfa-media.ru;
    server_tokens   off;

    # Эта секция обязательна, она говорит nginx слушать роут по которому certbot
    # проверит подлинность домена
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    # Эта секция необязательна, она нужна для редиректа трафика с http://
    # на https://
    location / {
        # 301 - permanent redirect, it will be cached in browser
        # so for testing, use 302 code so it won't be permanently cached in browser
        return 302 https://goodwinback.dfa-media.ru$request_uri;
    }
}

server {
        listen 443 default_server ssl http2;
        listen [::]:443 ssl http2;

        server_name goodwinback.dfa-media.ru;

        ssl_certificate /etc/nginx/ssl/live/goodwinback.dfa-media.ru/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/live/goodwinback.dfa-media.ru/privkey.pem;

        location / {
								# Здесь тебе скорее всего надо поменять только значение `proxy_pass`
								# чтобы nginx редиректил на твоё приложение

                proxy_pass              http://5.35.90.18:3000;
                proxy_set_header        Host $host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        }

	location /api/v1/ {
                proxy_pass              http://5.35.90.18:8000;
                proxy_http_version      1.1;
                proxy_set_header        Upgrade $http_upgrade;
                proxy_set_header        Connection "upgrade";
                proxy_set_header        Host $host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header        X-Forwarded-Proto $scheme;
        }

        location /static/ {
                proxy_pass              http://5.35.90.18:8000;
                proxy_set_header        Host $host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        }
	
	location /media/ {
                proxy_pass              http://5.35.90.18:8000;
                proxy_set_header        Host $host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        }

	location /admin/ {
                proxy_pass              http://5.35.90.18:8000;
                proxy_set_header        Host $host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        }
}

server {
        listen  80;
        listen [::]:80;

        server_name     goodwinfinance.dfa-media.ru;
        server_tokens   off;

				# Эта секция обязательна, она говорит nginx слушать роут по которому certbot
				# проверит подлинность домена
        location /.well-known/acme-challenge/ {
                root /var/www/certbot;
        }

				# Эта секция необязательна, она нужна для редиректа трафика с http://
				# на https://
        location / {
								# 301 - permanent redirect, it will be cached in browser
								# so for testing, use 302 code so it won't be permanently cached in browser
                return 302 https://goodwinfinance.dfa-media.ru$request_uri;
        }
}

server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name goodwinfinance.dfa-media.ru;

        ssl_certificate /etc/nginx/ssl/live/goodwinfinance.dfa-media.ru/fullchain.pem;
        ssl_certificate_key /etc/nginx/ssl/live/goodwinfinance.dfa-media.ru/privkey.pem;

        location / {
								# Здесь тебе скорее всего надо поменять только значение `proxy_pass`
								# чтобы nginx редиректил на твоё приложение

                proxy_pass              http://5.35.90.18:3000;
                proxy_set_header        Host $host;
                proxy_set_header        X-Real-IP $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        }
}

server {
        listen  80;
        listen [::]:80;

        server_name     goodwinsite.dfa.media;
        server_tokens   off;

				# Эта секция обязательна, она говорит nginx слушать роут по которому certbot
				# проверит подлинность домена
        location /.well-known/acme-challenge/ {
                root /var/www/certbot;
        }

				# Эта секция необязательна, она нужна для редиректа трафика с http://
				# на https://
        location / {
								# 301 - permanent redirect, it will be cached in browser
								# so for testing, use 302 code so it won't be permanently cached in browser
                return 302 https://goodwinsite.dfa.media$request_uri;
        }
}
